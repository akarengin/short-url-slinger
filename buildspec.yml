version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 22
    commands:
      - echo "Installing frontend dependencies..."
      - npm install
      - echo "Installing backend dependencies..."
      - (cd lambda-functions && npm install)

  pre_build:
    commands:
      - echo "Running pre-build commands..."

  build:
    commands:
      - echo "Building React application..."
      - npm run build
      - echo "Building backend..."
      - (cd lambda-functions && npm run build)

  post_build:
    commands:
      - echo "Build finished on `date`"
      # If you use AWS SAM or CloudFormation, you can package your application here.
      # For example, using AWS SAM:
      # - sam package --template-file infrastructure/template.yml --s3-bucket your-artifact-bucket-name --output-template-file packaged-template.yml

artifacts:
  files:
    # Frontend application
    - 'dist/**/*'
    # Backend Lambda functions (adjust the path to your compiled code)
    - 'lambda-functions/dist/**/*'
    # Infrastructure as Code templates
    - 'infrastructure/**/*'
    # Packaged template file if you are using one
    # - packaged-template.yml
  base-directory: . # Set base-directory to root to include all artifacts
  name: short-url-slinger-build-$(date +%Y-%m-%d-%H-%M-%S)

cache:
  paths:
    - node_modules/**/*
    # Add path to backend node_modules to cache them as well
    - lambda-functions/node_modules/**/*
